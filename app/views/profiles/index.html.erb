<% content_for :stylesheets do %>
  <%= stylesheet_link_tag "profiles/index" %>
<% end %>
<% content_for :title, "ユーザー管理" %>
<%= render partial: "layouts/sidebar" %>

<div class="main-content">
  <div class="container">
    <div class="header">
      <h1><i class="fas fa-users"></i> ユーザー管理</h1>
    </div>

    <div class="content-container">
      <div class="filter-section">
        <div class="filter-header">
          <div class="filter-title">
            <div class="section-icon"><i class="fas fa-search"></i></div>
            検索・フィルター
          </div>
        </div>
        <div class="filter-content">
          <%= search_form_for @q, url: profiles_path, method: :get, local: true do |f| %>
            <div class="filter-grid">
              <div class="form-group">
                <label class="form-label">権限レベル</label>
                <%= f.select :role_eq, 
                    options_for_select([
                      ['すべての権限', '']
                    ] + User.roles.map { |role, v| [I18n.t("activerecord.attributes.users.role.#{role}"), v] }, f.object.role_eq), 
                    {}, 
                    { class: "form-select" } %>
              </div>
              <div class="form-group">
                <label class="form-label">会社名</label>
                <%= f.select :company_japanese_name_eq, 
                    options_for_select([
                      ['すべての会社', '']
                    ] + @companies.map { |company| [company.japanese_name, company.japanese_name] }, f.object.company_japanese_name_eq), 
                    {}, 
                    { class: "form-select" } %>
              </div>
              <div class="form-group">
                <label class="form-label">名前</label>
                <%= f.search_field :name_cont, 
                    placeholder: "ユーザー名で検索...", 
                    class: "form-input" %>
              </div>
              <div class="form-group">
                <label class="form-label">メールアドレス</label>
                <%= f.search_field :email_cont, 
                    placeholder: "メールアドレスで検索...", 
                    class: "form-input" %>
              </div>
              <div class="form-group">
                <%= f.submit "検索実行", class: "btn btn-primary" do %>
                  <i class="fas fa-search"></i> 検索実行
                <% end %>
              </div>
            </div>
          <% end %>
        </div>
      </div>

      <!-- テーブルセクション -->
      <div class="table-section">
        <div class="table-header">
          <div class="table-title">
            <div class="section-icon"><i class="fas fa-table"></i></div>
            ユーザーリスト（<%= @users&.length %>名）
          </div>
        </div>
        <div class="user-table-container">
          <table class="user-table">
            <thead>
              <tr>
                <th><%= sort_link(@q, :name, "名前") %></th>
                <th><%= sort_link(@q, :email, "メールアドレス") %></th>
                <th><%= sort_link(@q, :role, "権限レベル") %></th>
                <th><%= sort_link(@q, :last_login_date, "最終ログイン") %></th>
                <th><%= sort_link(@q, :created_at, "登録日") %></th>
                <th>ステータス</th>
                <th>操作</th>
              </tr>
            </thead>
            <tbody>
              <% @users.each do |user| %>
                <tr>
                  <td>
                    <div class="user-info">
                      <div class="user-avatar"><%= user.name[0]%></div>
                      <div class="user-details">
                        <div class="user-name"><%= user.name %><br>(<%= user.company_name%>)</div>
                      </div>
                    </div>
                  </td>
                  <td class="text-sm"><%= user.email %></td>
                  <td>
                    <span class="permission-badge permission-<%= user.role %>"><%= I18n.t("activerecord.attributes.users.role.#{user.role}") %></span>
                  </td>
                  <td class="text-sm"><%= user.last_login_date %></td>
                  <td class="text-sm"><%= date_only(user.created_at) %></td>
                  <td>
                    <span class="permission-badge"><%= user.status ? "アクティブ" : "非アクティブ" %></span>
                  </td>
                  <td>
                    <%= link_to profile_path(user.id), class: "action-link" do %>
                      <i class="fas fa-edit"></i> 編集
                    <% end %>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
