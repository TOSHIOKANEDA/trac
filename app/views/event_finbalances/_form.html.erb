<div class="form-container">
  <!-- 請求情報セクション -->
  <div class="form-section">
    <div class="section-header">
      <div class="section-title">
        <div class="section-icon"><i class="fas fa-yen-sign"></i></div>
        請求編集
      </div>
    </div>
    <div class="section-content">
      <div class="event-finbalance-info-left">
        <!-- 件名 -->
        <div class="pic-name-section">
          <label>件名:</label>
          <%= f.text_field :subject, class: "pic-name-input", placeholder: "件名"%>
        </div>

        <!-- 会社名 -->
        <div class="company-name-section">
          <label>会社名:</label>
          <%= f.select :company_id, 
                options_from_collection_for_select(@event_companies, :id, :name), 
                { prompt: "会社を選択してください" },
                class: "company-name-input" %>
        </div>

        <!-- 担当者名 -->
        <div class="pic-name-section">
          <label>ご担当者:</label>
          <%= f.text_field :client_pic_name, class: "pic-name-input", placeholder: "担当者名"%>
        </div>

        <!-- 請求詳細情報 -->
        <div class="event-finbalance-details-grid">
          <div class="detail-row">
            <label class="detail-label">入金期日：</label>
            <div class="detail-value">
              <%= f.date_field :due_date, class: "pic-name-input", placeholder: "入金期日"%>
            </div>
          </div>

          <div class="detail-row">
            <label class="detail-label">消費税率：</label>
            <div class="detail-value">
              <%= f.text_field :tax_percent, 
                  class: "pic-name-input tax-percent",
                  data: { action: "input->event-finbalance-new#calculateTotals" } %>
              <span style="margin-left: 5px;">%</span>
            </div>
          </div>

          <div class="detail-row">
            <label class="detail-label">仕入合計：</label>
            <div class="detail-value">
              <%= f.text_field :expense,
                  class: "detail-input total-amount",
                  readonly: true %>
            </div>
          </div>

          <div class="detail-row">
            <label class="detail-label">売上合計：</label>
            <div class="detail-value">
              <%= f.text_field :income,
                  class: "detail-input total-amount",
                  readonly: true %>
            </div>
          </div>

          <div class="detail-row">
            <label class="detail-label">小計（税抜）：</label>
            <div class="detail-value">
              <%= f.text_field :small_total,
                  class: "detail-input total-amount",
                  readonly: true %>
            </div>
          </div>

          <div class="detail-row">
            <label class="detail-label">消費税：</label>
            <div class="detail-value" >
              <%= f.text_field :comumption_tax_total,
                  class: "detail-input total-amount",
                  readonly: true %>
            </div>
          </div>

          <div class="detail-row">
            <label class="detail-label">請求金額：</label>
            <div class="detail-value" >
              <%= f.text_field :total_amount,
                  class: "detail-input total-amount",
                  readonly: true %>
            </div>
          </div>

          <div class="detail-row">
            <label class="detail-label">粗利合計：</label>
            <div class="detail-value">
              <%= f.text_field :balance,
                  class: "detail-input total-amount",
                  readonly: true %>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 明細テーブルセクション -->
  <div class="form-section">
    <div class="section-header">
      <div class="section-title">
        <div class="section-icon"><i class="fas fa-list"></i></div>
        明細項目
      </div>
    </div>
    <div class="section-content">
      <div class="items-table-container">
        <table class="items-table">
          <thead>
            <tr>
              <th>項目名</th>
              <th>単位</th>
              <th>課税</th>
              <th>通貨</th>
              <th>換算レート</th>
              <th>数量</th>
              <th>仕入単価</th>
              <th>仕入金額</th>
              <th>売上単価</th>
              <th>売上金額</th>
              <th>粗利</th>
              <th>粗利率</th>
              <th>備考</th>
              <th>削除</th>
            </tr>
          </thead>
          <tbody data-event-finbalance-new-target="detailBody">
            <%= f.fields_for :event_finbalance_assemblies do |item| %>
              <%= render 'item', item: item %>
            <% end %>
          </tbody>
        </table>
      </div>

      <div style="margin-top: 15px; display: flex; gap: 10px;">
        <button type="button" class="btn btn-secondary" data-action="click->event-finbalance-new#addItemRow">
          <i class="fas fa-plus"></i> 項目を追加
        </button>
      </div>
    </div>
  </div>
</div>

<div id="finbalance-items" style="display: none;">
  <%= options_from_collection_for_select(@finbalance_items, :id, :item_name) %>
</div>
<div id="unit-options" style="display: none;">
  <%= options_for_select(@units) %>
</div>
