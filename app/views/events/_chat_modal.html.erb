<div class="modal-overlay" data-event-new-target="chatModalOverlay" data-action="click->event-new#closeChatModal">
  <div class="modal_show" data-event-new-target="chatModalContent">
    <div class="modal-header">
      <div class="modal-title">
        <i class="fas fa-plus"></i>
        <span><%= @other_chat.visible? ? "ËøΩÂä†„Åó„Åü„ÉÅ„É£„ÉÉ„ÉàÁ∑®ÈõÜ" : "„ÉÅ„É£„ÉÉ„ÉàËøΩÂä†" %></span>
      </div>
      <button class="modal-close" data-action="click->event-new#closeChatCreation">
        <i class="fas fa-times"></i>
      </button>
    </div>
    
  <div class="modal-content">
    <%= form_with model: [@event, @other_chat], 
                  url: event_chat_path(@event, @other_chat), 
                  method: :patch,
                  local: true,
                  data: { 
                    "event-new-target": "chatForm",
                    "action": "submit->event-new#createChat"
                  } do |form| %>
      
      <div class="form-group">
        <%= form.label :name, "„ÉÅ„É£„ÉÉ„ÉàÂêç", class: "form-label" %>
        <%= form.text_field :name, 
                            class: "form-input", 
                            placeholder: "„ÉÅ„É£„ÉÉ„ÉàÂêç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ",
                            data: { "event-new-target": "chatNameInput" },
                            required: true %>
      </div>

      <!-- üî¥ ÈáçË¶ÅÔºövisible „Çí true „Å´Ë®≠ÂÆö -->
      <%= form.hidden_field :visible, value: true %>
      
      <div class="form-group" style="margin-top:25px;">
        <label class="form-label">ÂèÇÂä†ËÄÖ</label>
        <div id="participants-container">
          <!-- Êó¢Â≠ò„ÅÆÂèÇÂä†ËÄÖ„Çífields_for„ÅßË°®Á§∫ -->
          <%= form.fields_for :chat_users do |chat_user_form| %>
            <div class="participant-item">
              <%= chat_user_form.hidden_field :user_id %>
              <%= chat_user_form.hidden_field :id %> <!-- Êó¢Â≠ò„É¨„Ç≥„Éº„Éâ„ÅÆÂ†¥Âêà -->
              <div class="participant-info">
                <div class="participant-avatar">„ÉÜ</div>
                <div class="participant-details">
                  <div class="participant-name"><%= chat_user_form.object&.user&.name %></div>
                  <div class="participant-company"><%= chat_user_form.object&.user&.company&.japanese_name %></div>
                </div>
              </div>
              <button type="button" class="remove-participant" data-action="click->event-new#removeExistingParticipant">
                <i class="fas fa-times"></i>
              </button>
              <%= chat_user_form.hidden_field :_destroy, value: false, class: "destroy-field" %>
            </div>
          <% end %>
          
          <!-- Êñ∞Ë¶èÂèÇÂä†ËÄÖ„ÇÇ„Åì„Åì„Å´ÂãïÁöÑ„Å´ËøΩÂä†„Åï„Çå„Çã -->
        </div>
        
        <!-- Êñ∞„Åó„ÅÑÂèÇÂä†ËÄÖËøΩÂä†Áî® -->
        <select data-event-new-target="participantSelect" class="form-select">
          <option value="">ÂèÇÂä†ËÄÖ„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
          <% @chat_users.each do |chat_user| %>
            <option value="<%= chat_user.user_id %>" data-name="<%= chat_user.name %>" data-company="<%= chat_user.company_name %>"><%= chat_user.user_and_company %></option>
          <% end %>
        </select>
        <button type="button" class="btn btn-secondary" style="margin-top:10px;" data-action="click->event-new#addParticipant">ÂèÇÂä†ËÄÖ„ÇíËøΩÂä†</button>
      </div>

      <div class="modal-actions">
        <%= form.submit "‰øùÂ≠ò", 
            class: "btn btn-primary",
            style: "margin-top:5px;",
            data: { 
              disable_with: "Âá¶ÁêÜ‰∏≠...",
              "action": "click->event-new#handleSubmitClick"
            } %>
      </div>
    <% end %>
  </div>
  </div>
</div>
