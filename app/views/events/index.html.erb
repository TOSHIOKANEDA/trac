<% content_for :stylesheets do %>
  <%= stylesheet_link_tag "events/index", "data-turbo-track": "reload" %>
<% end %>
<% content_for :title, "案件カレンダー" %>
<%= render partial: "layouts/sidebar" %>
<main class="main-content" data-controller="calendar" data-turbo="false">
  <div class="flex-1 p-6 lg:p-8 overflow-y-auto relative">
    <!-- ヘッダー -->
    <div class="flex items-center gap-4 mb-6">
      <!-- ビュー切り替えボタン（左寄せ） -->
      <div class="flex gap-2">
        <button data-calendar-target="monthViewBtn" data-action="click->calendar#switchToMonth" class="px-4 py-2 rounded-lg font-medium transition-all duration-200 bg-blue-600 text-white hover:bg-blue-700 flex items-center gap-2">
          <i data-lucide="calendar" class="h-5 w-5"></i>
          月表示
        </button>
        <button data-calendar-target="weekViewBtn" data-action="click->calendar#switchToWeek" class="px-4 py-2 rounded-lg font-medium transition-all duration-200 bg-white border border-gray-300 text-gray-700 hover:bg-gray-50 flex items-center gap-2">
          <i data-lucide="list" class="h-5 w-5"></i>
          週表示
        </button>
      </div>

      <!-- 中央に月表示と前後ボタン -->
      <div class="flex-1 flex items-center justify-center gap-6">
        <button data-calendar-target="prevMonthBtn" data-action="click->calendar#prevMonth" class="p-2 text-gray-600 hover:text-gray-900">
          <i data-lucide="chevron-left" class="h-6 w-6"></i>
        </button>
        <h2 data-calendar-target="currentMonth" class="text-2xl font-bold text-gray-900 w-50 text-center">2025年 9月</h2>
        <button data-calendar-target="nextMonthBtn" data-action="click->calendar#nextMonth" class="p-2 text-gray-600 hover:text-gray-900">
          <i data-lucide="chevron-right" class="h-6 w-6"></i>
        </button>
      </div>

      <!-- 表示選択ドロップダウン（月表示のみ） -->
      <div class="relative">
        <button data-calendar-target="displaySelectBtn" data-action="click->calendar#toggleDisplayMenu" class="px-4 py-2 rounded-lg font-medium transition-all duration-200 bg-white border border-gray-300 text-gray-700 hover:bg-gray-50 flex items-center gap-2">
          表示選択
          <i data-lucide="chevron-down" class="h-4 w-4"></i>
        </button>
        <div data-calendar-target="displayMenu" class="hidden absolute right-0 mt-2 w-56 bg-white border border-gray-300 rounded-lg shadow-lg z-50 p-4">
          <div class="space-y-3">
            <label class="flex items-center cursor-pointer">
              <input type="radio" name="display-option" value="id" data-action="change->calendar#changeDisplayOption" class="mr-3" checked>
              <span>ID番号</span>
            </label>
            <label class="flex items-center cursor-pointer">
              <input type="radio" name="display-option" value="mbl_no" data-action="change->calendar#changeDisplayOption" class="mr-3">
              <span>MBL No.</span>
            </label>
            <label class="flex items-center cursor-pointer">
              <input type="radio" name="display-option" value="hbl_no" data-action="change->calendar#changeDisplayOption" class="mr-3">
              <span>HBL No.</span>
            </label>
            <label class="flex items-center cursor-pointer">
              <input type="radio" name="display-option" value="shipper" data-action="change->calendar#changeDisplayOption" class="mr-3">
              <span>Shipper</span>
            </label>
            <label class="flex items-center cursor-pointer">
              <input type="radio" name="display-option" value="cnee" data-action="change->calendar#changeDisplayOption" class="mr-3">
              <span>Cnee</span>
            </label>
            <label class="flex items-center cursor-pointer">
              <input type="radio" name="display-option" value="mode" data-action="change->calendar#changeDisplayOption" class="mr-3">
              <span>Mode</span>
            </label>
            <label class="flex items-center cursor-pointer">
              <input type="radio" name="display-option" value="container" data-action="change->calendar#changeDisplayOption" class="mr-3">
              <span>Container</span>
            </label>
            <label class="flex items-center cursor-pointer">
              <input type="radio" name="display-option" value="term" data-action="change->calendar#changeDisplayOption" class="mr-3">
              <span>Term</span>
            </label>
          </div>
        </div>
      </div>

      <!-- ETD/ETA チェックボックス -->
      <div class="flex flex-col gap-4 items-start ml-5">
        <!-- ETD（出航） -->
        <label class="flex flex-row items-center gap-3 cursor-pointer">
          <input
            type="checkbox"
            data-calendar-target="loadingFilterCheckbox"
            data-action="change->calendar#filterLoading"
            class="checkbox-etd w-5 h-5"
            checked
          >
          <span class="text-sm font-medium text-gray-900">ETD</span>
        </label>

        <!-- ETA（到着） -->
        <label class="flex flex-row items-center gap-3 cursor-pointer">
          <input
            type="checkbox"
            data-calendar-target="dischargingFilterCheckbox"
            data-action="change->calendar#filterDischarging"
            class="checkbox-eta w-5 h-5"
            checked
          >
          <span class="text-sm font-medium text-gray-900">ETA</span>
        </label>
      </div>
    </div>

    <!-- 月表示コンテナ -->
    <div data-calendar-target="calendar" id="calendar" class="bg-white p-3 fc-container" style="min-height: 600px;"></div>

    <!-- 週表示コンテナ -->
    <div data-calendar-target="weekViewContainer" id="week-view-container" class="hidden bg-white p-3 overflow-y-auto" style="min-height: 600px;"></div>

    <!-- ツールチップ -->
    <div data-calendar-target="dateTooltip" id="date-tooltip" class="hidden absolute bg-gray-800 text-white px-2 py-1 rounded text-sm z-50"></div>

    <!-- 隠れたイベント表示用ツールチップ -->
    <div data-calendar-target="hiddenEventsTooltip" id="hidden-events-tooltip" class="hidden absolute bg-white border border-gray-300 rounded-lg shadow-lg z-50" style="min-width: 250px; max-width: 350px; max-height: 300px; display: flex; flex-direction: column;">
      <!-- ヘッダー（クローズボタン） -->
      <div class="flex justify-between items-center p-3 border-b border-gray-300 sticky top-0 bg-white rounded-t-lg z-10">
        <span class="text-sm font-semibold text-gray-800">追加のイベント</span>
        <button type="button" data-action="click->calendar#closeHiddenEventsTooltip" class="text-gray-500 hover:text-gray-900 text-lg leading-none font-bold">×</button>
      </div>
      <!-- リスト -->
      <div class="p-3 space-y-2 overflow-y-auto" data-calendar-target="hiddenEventsList"></div>
    </div>
  </div>

  <!-- モーダル -->
  <div data-calendar-target="eventModal" data-action="click->calendar#modalBackgroundClick" id="event-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
    <div class="relative top-10 mx-auto p-5 border w-full max-w-3xl shadow-lg rounded-md bg-white mb-10">
      <div data-calendar-target="detailsModalContent" id="details-modal-content" class="max-h-[80vh] overflow-y-auto pr-2">
      </div>
    </div>
  </div>
</main>
