<div class="chat-widgets">
  <% @chats.each do |chat| %>
    <div class="chat-widget minimized" id="<%= dom_id(chat) %>" 
      data-controller="event-new"  
      data-event-new-chat-id-value="<%= chat.id %>"
      data-event-new-event-id-value="<%= @event.id %>"
      style="visibility: hidden;<%= '; display: none;' if event_edit_chat_hidden(chat) %>">

      <!-- ヘッダー -->
      <div class="chat-header <%= chat.chat_type %>"
          data-chat-id="<%= dom_id(chat) %>"
          data-action="click->event-new#toggleChat">
        <span>
          <i class="fas fa-comments"></i>
          <%= chat.name %>
        </span>
        <button class="chat-toggle" data-event-new-target="toggleButton"></button>
      </div>

      <!-- メッセージ一覧 -->
      <div class="chat-content" id="<%= dom_id(chat, :messages) %>" data-event-new-target="chatContent">
        <%= turbo_frame_tag dom_id(chat, :messages) do %>
          <% chat.messages.order(:created_at).each do |message| %>
            <div class="chat-message">
              <strong><%= message.user.name %> <%= date_with_time(message.created_at) %></strong><br>
              <%= message.content %>
            </div>
          <% end %>
        <% end %>
      </div>

      <!-- メッセージ入力 -->
      <div class="chat-input" data-event-new-target="chatInput">
        <%= form_with model: Message.new,
                      url: event_chat_messages_path(@event, chat),
                      data: { turbo_frame: dom_id(chat, :messages) },
                      local: false do |f| %>
          <%= f.text_field :content,
                          placeholder: "メッセージを入力...",
                          data: { action: "keypress->event-new#sendChatMessage" },
                          class: "form-input" %>
        <% end %>
      </div>
    </div>
  <% end %>
</div>
