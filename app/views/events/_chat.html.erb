<!-- チャットウィジェット -->
<div class="chat-widgets">
  <% @event.chats.each do |chat| %>
    <div class="chat-widget" id="<%= dom_id(chat) %>" 
         data-controller="event-new"
         data-event-new-chat-id-value="<%= chat.id %>">
      
      <!-- ヘッダー -->
      <div class="chat-header <%= chat.chat_type %>"
           data-action="click->event-new#toggleChat">
        <span>
          <i class="fas fa-comments"></i>
          <%= chat.name %>
        </span>
        <button class="chat-toggle">−</button>
      </div>

      <!-- メッセージ一覧 -->
      <div class="chat-content" id="<%= dom_id(chat, :messages) %>">
        <%= turbo_frame_tag dom_id(chat, :messages) do %>
          <% chat.messages.order(:created_at).each do |message| %>
            <div class="chat-message">
              <strong><%= message.user.name %> <%= message.created_at.strftime("%H:%M") %></strong><br>
              <%= message.content %>
            </div>
          <% end %>
        <% end %>
      </div>

      <!-- メッセージ入力 -->
      <div class="chat-input">
        <%= form_with model: Message.new,
                      url: event_chat_messages_path(@event, chat),
                      data: { turbo_frame: dom_id(chat, :messages) },
                      local: false do |f| %>
          <%= f.text_field :content,
                          placeholder: "メッセージを入力...",
                          data: { action: "keypress->event-new#sendChatMessage" },
                          class: "form-input" %>
        <% end %>
      </div>
    </div>
  <% end %>
</div>
