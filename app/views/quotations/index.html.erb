<% content_for :stylesheets do %>
  <%= stylesheet_link_tag "quotations/index", "data-turbo-track": "reload" %>
<% end %>
<% content_for :title, "見積一覧" %>

<div style="width:100%;">
  <%= render partial: "layouts/sidebar" %>
  
  <div class="main-content">
    <div class="container">
      <div class="header">
        <h1><i class="fas fa-list"></i> 見積一覧</h1>
        <div class="header-actions">
          <%= button_to new_quotation_path, method: :get, class: "btn btn-primary" do %>
            <i class="fas fa-plus"></i> 見積作成
          <% end %>
        </div>
      </div>

      <div class="content-container">
        <!-- フィルター・検索セクション -->
        <div class="filter-section">
          <div class="filter-header">
            <div class="filter-title">
              <div class="section-icon"><i class="fas fa-search"></i></div>
              検索・フィルター
            </div>
          </div>
          <div class="filter-content">
            <%= search_form_for @q, url: search_quotations_path, local: true, data: { turbo: false }, html: { method: :post } do |f| %>
              <div class="filter-grid">
                <div class="form-group">
                  <label class="form-label">種別</label>
                  <%= f.select :shipment_eq, 
                      options_for_select([
                        ['すべて', '']] + 
                        Quotation.shipments.map { |k,v| [I18n.t("activerecord.attributes.quotation.shipment.#{k}"), v] }, @q.shipment_eq), 
                      {}, 
                      { class: "form-select" } %>
                </div>

                <div class="form-group">
                  <label class="form-label">モード</label>
                  <%= f.select :mode_eq, 
                      options_for_select([
                        ['すべて', '']] + 
                        Quotation.modes.map { |k,v| [I18n.t("activerecord.attributes.quotation.mode.#{k}"), v] }, @q.mode_eq), 
                      {}, 
                      { class: "form-select" } %>
                </div>
                
                <div class="form-group">
                  <label class="form-label">積み地</label>
                  <%= f.search_field :port_of_loading_cont, 
                      class: "form-input" %>
                </div>
                
                <div class="form-group">
                  <label class="form-label">揚げ地</label>
                  <%= f.search_field :port_of_discharge_cont, 
                      class: "form-input" %>
                </div>

                <div class="form-group">
                  <label class="form-label">条件</label>
                  <%= f.search_field :term_cont, 
                      class: "form-input" %>
                </div>

                <div class="form-group">
                  <label class="form-label">発行日（開始）</label>
                  <%= f.search_field :issued_date_gteq, 
                      type: "date",
                      class: "form-input" %>
                </div>

                <div class="form-group">
                  <label class="form-label">発行日（終了）</label>
                  <%= f.search_field :issued_date_lteq, 
                      type: "date",
                      class: "form-input" %>
                </div>

                <div class="form-group">
                  <label class="form-label">貨物</label>
                  <%= f.search_field :cargo_cont, 
                      class: "form-input" %>
                </div>

                <div class="form-group">
                  <label class="form-label">会社名</label>
                  <%= f.search_field :client_japanese_name_cont, 
                      class: "form-input",
                      placeholder: "会社名で検索",
                      value: params.dig(:q, :client_japanese_name_cont) %>
                </div>

                <div class="form-group">
                  <%= f.submit "検索実行", class: "btn btn-primary" %>
                  <%= link_to "クリア", quotations_path, class: "btn btn-secondary" %>
                </div>
              </div>
            <% end %>
          </div>
        </div>

        <!-- テーブルセクション -->
        <div class="table-section">
          <div class="table-header">
            <div class="table-title">
              <div class="section-icon"><i class="fas fa-table"></i></div>
              見積リスト
            </div>
          </div>
          <div class="project-table-container">
            <table class="project-table">
              <thead>
                <tr>
                  <th>種別</th>
                  <th>モード</th>
                  <th>積み地</th>
                  <th>揚げ地</th>
                  <th>条件</th>
                  <th>発行日</th>
                  <th>貨物</th>
                  <th>会社名</th>
                  <th>編集</th>
                  <th>案件作成</th>
                </tr>
              </thead>
              <tbody>
                <% @quotations.each do |quotation| %>
                  <tr>
                    <td>
                      <span class="type-badge <%= shipment_css_class(quotation, controller_name) %>">
                        <%= quotation.shipment.present? ? I18n.t("activerecord.attributes.quotation.shipment.#{quotation.shipment}") : "-" %>
                      </span>
                    </td>
                    <td class="text-sm">
                      <%= quotation.mode.present? ? I18n.t("activerecord.attributes.quotation.mode.#{quotation.mode}") : "-" %>
                    </td>
                    <td class="text-sm"><%= list_item_with_na(quotation.port_of_loading) %></td>
                    <td class="text-sm"><%= list_item_with_na(quotation.port_of_discharge) %></td>
                    <td class="text-sm"><%= list_item_with_na(quotation.term) %></td>
                    <td class="text-sm"><%= quotation.issue_at&.strftime("%Y/%m/%d") || "-" %></td>
                    <td class="text-sm">
                      <div class="truncate-text" title="<%= list_item_with_na(quotation.cargo) %>">
                        <%= list_item_with_na(quotation.cargo) %>
                      </div>
                    </td>
                    <td class="text-sm">
                      <div class="truncate-text" title="<%= list_item_with_na(quotation.client.japanese_name) %>">
                        <%= list_item_with_na(quotation.client.japanese_name) %>
                      </div>
                    </td>
                    <td>
                      <%= link_to edit_quotation_path(quotation.id), class: "action-link" do %>
                        <i class="fas fa-edit"></i> 編集
                      <% end %>
                    </td>
                    <td>
                      <%= link_to paste_events_path(quotation_id: quotation.id), method: :post, class: "action-link" do %>
                        <i class="fas fa-edit"></i> 案件作成
                      <% end %>
                    </td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>