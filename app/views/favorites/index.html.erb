<% content_for :stylesheets do %>
  <%= stylesheet_link_tag "favorites/index", "data-turbo-track": "reload" %>
<% end %>
<% content_for :title, "お気に入り一覧" %>

<div style="width:100%;">
  <%= render partial: "layouts/sidebar" %>
  
  <div class="main-content">
    <div class="container">
      <div class="header">
        <h1><i class="fas fa-list"></i> お気に入り一覧</h1>
        <div class="header-actions">
          <%= button_to new_favorite_path, method: :get, class: "btn btn-primary" do %>
            <i class="fas fa-plus"></i> お気に入り追加
          <% end %>
        </div>
      </div>

      <div class="content-container">
        <!-- フィルター・検索セクション -->
        <div class="filter-section">
          <div class="filter-header">
            <div class="filter-title">
              <div class="section-icon"><i class="fas fa-search"></i></div>
              検索・フィルター
            </div>
          </div>
          <div class="filter-content">
            <%= search_form_for @q, url: search_favorites_path, local: true, data: { turbo: false }, html: { method: :post } do |f| %>
              <div class="filter-grid">
                <div class="form-group">
                  <label class="form-label">お気に入り名</label>
                  <%= f.search_field :name_cont,
                      class: "form-input"%>
                </div>

                <div class="form-group">
                  <label class="form-label">種別</label>
                  <%= f.select :favorite_shipment_shipment_eq, 
                      options_for_select([
                        ['すべて', '']] + 
                        FavoriteShipment.shipments.map { |k,v| [I18n.t("activerecord.attributes.favorite_shipment.shipment.#{k}"), k,v] }, @q.favorite_shipment_shipment_eq), 
                      {}, 
                      { class: "form-select" } %>
                </div>
                
                <div class="form-group">
                  <label class="form-label">積み地</label>
                  <%= f.search_field :favorite_shipment_port_of_loading_cont, 
                      class: "form-input" %>
                </div>
                
                <div class="form-group">
                  <label class="form-label">揚げ地</label>
                  <%= f.search_field :favorite_shipment_port_of_discharge_cont, 
                      class: "form-input" %>
                </div>
                
                <div class="form-group">
                  <label class="form-label">Shipper名</label>
                  <%= f.search_field :shipper_name_cont, 
                      placeholder: "英語名で検索...", 
                      class: "form-input",
                      value: params.dig(:q, "shipper_name_cont") %>
                </div>

                <div class="form-group">
                  <label class="form-label">Consignee名</label>
                  <%= f.search_field :consignee_name_cont, 
                      placeholder: "英語名で検索...", 
                      class: "form-input",
                      value: params.dig(:q, "consignee_name_cont") %>
                </div>

                <div class="form-group">
                  <%= f.submit "検索実行", class: "btn btn-primary" %>
                  <%= link_to "クリア", favorites_path, class: "btn btn-secondary" %>
                </div>
              </div>
            <% end %>
          </div>
        </div>

        <!-- テーブルセクション -->
        <div class="table-section">
          <div class="table-header">
            <div class="table-title">
              <div class="section-icon"><i class="fas fa-table"></i></div>
              お気に入りリスト
            </div>
          </div>
          <div class="project-table-container">
            <table class="project-table">
              <thead>
                <tr>
                  <th>種別</th>
                  <th>お気に入り名</th>
                  <th>積み地</th>
                  <th>揚げ地</th>
                  <th>Shipper名</th>
                  <th>Consignee名</th>
                  <th></th>
                  <th></th>
                </tr>
              </thead>
              <tbody>
                <% @favorites.each do |favorite| %>
                  <tr>
                    <td>
                      <span class="type-badge <%= shipment_css_class(favorite, controller_name) %>"><%= favorite&.shipment.blank? ? "" : I18n.t("activerecord.attributes.favorite_shipment.shipment.#{EventShipment.shipments.keys[favorite&.shipment]}") %></span>
                    </td>
                    <td class="text-sm"><%= list_item_with_na(favorite&.name) %></td>
                    <td class="text-sm"><%= list_item_with_na(favorite&.pol) %></td>
                    <td class="text-sm"><%= list_item_with_na(favorite&.pod) %></td>
                    <td class="text-sm"><div class="truncate-text" title="<%= list_item_with_na(favorite&.shipper) %>"><%= list_item_with_na(favorite&.shipper) %></div></td>
                    <td class="text-sm"><div class="truncate-text" title="<%= list_item_with_na(favorite&.consignee) %>"><%= list_item_with_na(favorite&.consignee) %></div></td>
                    <td>
                      <%= link_to edit_favorite_path(favorite.id), class: "action-link" do %>
                        <i class="fas fa-edit"></i> 編集
                      <% end %>
                    </td>
                    <td>
                      <%= link_to paste_events_path(favorite_id: favorite.id), method: :post, class: "action-link" do %>
                        <i class="fas fa-plus"></i> 案件登録
                      <% end %>
                    </td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>