<% content_for :stylesheets do %>
  <%= stylesheet_link_tag "systems/index", "data-turbo-track": "reload" %>
<% end %>
<% content_for :title, "システム管理" %>
<%= render partial: "layouts/sidebar" %>
<div class="main-content">
  <div class="container">
    <div class="header">
      <h1><i class="fas fa-cogs"></i> システム管理</h1>
    </div>

    <div class="content-container">
      <div class="tab-management-container" data-controller="tabs">
        <div class="tab-header">
          
          <%# --- クラスを動的に変更 --- %>
          <button class="tab-button <%= 'active' if @active_tab == 'finbalance-tab' %>" 
                  data-tabs-target="tabButton" data-target="finbalance-tab" data-action="tabs#switchTab">
            支払い・請求項目
          </button>
          
          <button class="tab-button <%= 'active' if @active_tab == 'port-tab' %>" 
                  data-tabs-target="tabButton" data-target="port-tab" data-action="tabs#switchTab">
            港名
          </button>
          
          <button class="tab-button <%= 'active' if @active_tab == 'industry-tab' %>" 
                  data-tabs-target="tabButton" data-target="industry-tab" data-action="tabs#switchTab">
            業種
          </button>
        </div>

        <div class="tab-content-wrapper">
          <div id="finbalance-tab" class="tab-content <%= 'active' if @active_tab == 'finbalance-tab' %> <%= 'hidden' unless @active_tab == 'finbalance-tab' %>" 
               data-tabs-target="tabContent">
            <div class="management-grid">
              <% finbalance_registration_inputs = Proc.new do |f| %>
                <%= render 'systems/form_input_group', f: f, attribute: :name, label_text: '項目名' %>
              <% end %>
              <%= render 'systems/registration_section', 
                title: '支払い・請求項目登録', 
                icon_class: 'fas fa-plus', 
                object: @finbalance_item, 
                url: finbalance_item_create_systems_path,
                form_elements: finbalance_registration_inputs
              %>
              <%= render 'systems/search_section', 
                  title: '項目名検索', 
                  icon_class: 'fas fa-search', 
                  url: finbalance_item_search_systems_path,
                  query_label: '項目名',
                  input_id: 'finbalance-search-name',
                  results: @finbalance_item_results,
                  search_query: @finbalance_search_query do |result| %>
                <li><%= result.item_name %></li>
              <% end %>
            </div>
          </div>

          <div id="port-tab" class="tab-content <%= 'active' if @active_tab == 'port-tab' %> <%= 'hidden' unless @active_tab == 'port-tab' %>" 
               data-tabs-target="tabContent">
            <div class="management-grid">
              <% port_registration_inputs = Proc.new do |f| %>
                <%= render 'systems/form_input_group', f: f, attribute: :name, label_text: '港名', placeholder_text: 'Tokyo' %>
                <%= render 'systems/form_input_group', f: f, attribute: :port_code, label_text: '港名（略称）', placeholder_text: 'JPTYO' %>
              <% end %>
              <%= render 'systems/registration_section', 
                title: '港名登録', 
                icon_class: 'fas fa-plus', 
                object: @port, 
                url: port_create_systems_path,
                form_elements: port_registration_inputs
              %>
              <%= render 'systems/search_section', 
                  title: '港名検索', 
                  icon_class: 'fas fa-search', 
                  url: port_search_systems_path,
                  query_label: '港名',
                  input_id: 'port-search-name', 
                  placeholder_text: 'Tokyo',
                  results: @port_results,
                  search_query: @port_search_query do |result| %>
                <li><%= result.name %> (<%= result.port_code %>)</li>
              <% end %>
            </div>
          </div>

          <div id="industry-tab" class="tab-content <%= 'active' if @active_tab == 'industry-tab' %> <%= 'hidden' unless @active_tab == 'industry-tab' %>" 
               data-tabs-target="tabContent">
            <div class="management-grid">
              <% industry_registration_inputs = Proc.new do |f| %>
                <%= render 'systems/form_input_group', f: f, attribute: :industry_name, label_text: '業種', placeholder_text: '梱包業' %>
              <% end %>
              <%= render 'systems/registration_section', 
                title: '業種登録', 
                icon_class: 'fas fa-plus', 
                object: @industry, 
                url: industry_create_systems_path,
                form_elements: industry_registration_inputs
              %>
              <%= render 'systems/search_section', 
                  title: '業種検索', 
                  icon_class: 'fas fa-search', 
                  url: industry_search_systems_path,
                  query_label: '業種名',
                  input_id: 'industry-search-name', 
                  placeholder_text: '梱包業',
                  results: @industry_results,
                  search_query: @industry_search_query do |result| %>
                <li><%= result.industry_name %></li>
              <% end %>
            </div>
          </div>

        </div>
      </div>

      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-header">
            <div class="stat-title">総API呼び出し数</div>
            <div class="stat-icon" style="background: #4caf50;">
              <i class="fas fa-chart-line"></i>
            </div>
          </div>
          <div class="stat-value">2,847</div>
        </div>
      </div>
      
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-header">
            <div class="stat-title">総API呼び出し数</div>
            <div class="stat-icon" style="background: #4caf50;">
              <i class="fas fa-chart-line"></i>
            </div>
          </div>
          <div class="stat-value">2,847</div>
        </div>
      </div>

      <div class="filter-section">
        <div class="filter-header">
          <div class="filter-title">
            <div class="section-icon"><i class="fas fa-filter"></i></div>
            ログフィルター
          </div>
        </div>
        <div class="filter-content">
          <div class="filter-grid">
            <div class="form-group">
              <label class="form-label">期間</label>
              <select class="form-select">
                <option value="">過去24時間</option>
                <option value="">過去7日間</option>
                <option value="">過去30日間</option>
                <option value="">カスタム期間</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">ステータス</label>
              <select class="form-select">
                <option value="">全てのステータス</option>
                <option value="">成功のみ</option>
                <option value="">エラーのみ</option>
                <option value="">警告のみ</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">APIエンドポイント</label>
              <select class="form-select">
                <option value="">全てのエンドポイント</option>
                <option value="">/vessels/search</option>
                <option value="">/ports/details</option>
                <option value="">/vessel/track</option>
              </select>
            </div>
            <div class="form-group">
              <button class="btn btn-primary">
                <i class="fas fa-search"></i> フィルター適用
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="table-section">
        <div class="table-header">
          <div class="table-title">
            <div class="section-icon"><i class="fas fa-ship"></i></div>
            MarineTraffic API履歴
          </div>
          <div class="api-status">
            <span class="status-badge status-active">API接続中</span>
          </div>
        </div>
        <div class="user-table-container">
          <table class="user-table">
            <thead>
              <tr>
                <th>リクエスト時刻</th>
                <th>APIエンドポイント</th>
                <th>ステータス</th>
                <th>レスポンス時間</th>
                <th>データ件数</th>
                <th>エラー詳細</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-sm">2025-08-06 12:45:32</td>
                <td class="text-sm font-medium">/vessels/search</td>
                <td>
                  <span class="status-badge status-success">200 OK</span>
                </td>
                <td class="text-sm">245ms</td>
                <td class="text-sm">127件</td>
                <td class="text-sm">-</td>
              </tr>
              <tr>
                <td class="text-sm">2025-08-06 12:44:18</td>
                <td class="text-sm font-medium">/ports/details</td>
                <td>
                  <span class="status-badge status-success">200 OK</span>
                </td>
                <td class="text-sm">189ms</td>
                <td class="text-sm">45件</td>
                <td class="text-sm">-</td>
              </tr>
              <tr>
                <td class="text-sm">2025-08-06 12:43:05</td>
                <td class="text-sm font-medium">/vessel/track</td>
                <td>
                  <span class="status-badge status-error">429 Rate Limit</span>
                </td>
                <td class="text-sm">102ms</td>
                <td class="text-sm">0件</td>
                <td class="text-sm">API制限に達しました</td>
              </tr>
              <tr>
                <td class="text-sm">2025-08-06 12:42:41</td>
                <td class="text-sm font-medium">/vessels/search</td>
                <td>
                  <span class="status-badge status-success">200 OK</span>
                </td>
                <td class="text-sm">312ms</td>
                <td class="text-sm">89件</td>
                <td class="text-sm">-</td>
              </tr>
              <tr>
                <td class="text-sm">2025-08-06 12:41:27</td>
                <td class="text-sm font-medium">/vessels/positions</td>
                <td>
                  <span class="status-badge status-warning">503 Service Unavailable</span>
                </td>
                <td class="text-sm">5000ms</td>
                <td class="text-sm">0件</td>
                <td class="text-sm">サーバーメンテナンス中</td>
              </tr>
              <tr>
                <td class="text-sm">2025-08-06 12:40:15</td>
                <td class="text-sm font-medium">/vessel/details/123456</td>
                <td>
                  <span class="status-badge status-success">200 OK</span>
                </td>
                <td class="text-sm">156ms</td>
                <td class="text-sm">1件</td>
                <td class="text-sm">-</td>
              </tr>
              <tr>
                <td class="text-sm">2025-08-06 12:39:42</td>
                <td class="text-sm font-medium">/ports/search</td>
                <td>
                  <span class="status-badge status-success">200 OK</span>
                </td>
                <td class="text-sm">223ms</td>
                <td class="text-sm">78件</td>
                <td class="text-sm">-</td>
              </tr>
              <tr>
                <td class="text-sm">2025-08-06 12:38:29</td>
                <td class="text-sm font-medium">/vessels/search</td>
                <td>
                  <span class="status-badge status-error">401 Unauthorized</span>
                </td>
                <td class="text-sm">89ms</td>
                <td class="text-sm">0件</td>
                <td class="text-sm">APIキーが無効です</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

    </div>
  </div>
</div>